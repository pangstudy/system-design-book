# 2장: 웹 서비스 설계 전 알아야 할 규모 감각

---

## 2장의 핵심 주제

* 웹 기반 대규모 시스템을 설계하기 전에, “숫자 감각”을 먼저 맞추는 챕터입니다.
* 특히 다음 네 가지를 다룹니다.

  * 데이터 크기(2의 제곱수 단위로 생각하기)
  * 지연 시간(latency) 감각
  * 가용성(availability)·SLA 숫자 해석
  * 간단한 서비스(트위터 등)를 예로 한 QPS·저장소 추정

이 장의 목표:
“유저 수, QPS, 데이터 크기, 가용성 목표”를 대략이라도 숫자로 말할 수 있게 만드는 것.

---

## 1. 데이터 크기와 2의 제곱수

### 왜 2의 제곱수로 생각하나?

* 컴퓨터 메모리/스토리지는 기본적으로 2진수 기반이라,
  `KB, MB, GB, TB` 등은 모두 2의 제곱수와 연결됩니다.
* 대규모 웹 시스템에서 “데이터가 얼마나 쌓이는지”, “저장소를 얼마나 잡아야 하는지” 감을 잡을 때 필수입니다.

### 단위 감 잡기 (웹 서비스 기준 예시)

* 1KB

  * 짧은 JSON 한 개, 간단한 유저 프로필 정보
* 수 KB ~ 수십 KB

  * 게시글 1개(텍스트 + 썸네일 URL + 메타데이터)
* 수백 KB ~ 수 MB

  * 피드 한 페이지(게시글 20~50개), 작은 이미지 파일
* 수 GB ~ 수 TB

  * 하루치 로그/이벤트, 서비스 전체 DB 스냅샷 등

### 왜 중요한가?

* “하루에 피드 글이 1억 건, 글당 1KB”라면

  * 하루 데이터: 100GB
  * 1년 데이터: 약 36.5TB
* 이런 계산을 할 수 있어야:

  * 저장소 용량 계획 (RDS, S3, 블록 스토리지 등)
  * 백업/아카이빙 전략
  * 캐시 메모리 사이즈(핫 데이터만 메모리에 올릴지 여부)

를 설계 단계에서 대략적으로 결정할 수 있습니다.

---

## 2. 지연 시간(latency) 감각

### 레벨별 대략 속도

정확한 숫자보다 “서로 몇 배 차이 나는지”가 중요합니다.

* 같은 서버 안

  * CPU 레지스터, L1/L2 캐시: ns(나노초) 단위
  * 메모리(RAM) 접근: 수십~수백 ns
* 디스크 I/O

  * SSD 랜덤 I/O: 수백 µs~수 ms
  * HDD: 더 느림
* 네트워크

  * 같은 리전 내 서버 간: 수백 µs~수 ms
  * 지역/대륙 간(한국 ↔ 미국 등): 수십~수백 ms

### 웹 설계에서 어떻게 쓰나?

* “메모리 vs 디스크 vs 네트워크” 비용을 체감하는 용도

  * 캐시를 쓰면 왜 빨라지는지
  * 같은 리전 내 통신 vs 리전 간 복제의 비용
* 예시:

  * RDB에서 디스크 기반 풀스캔 한 번 vs Redis 캐시 조회 한 번
  * 서울 리전 API 서버 ↔ 서울 리전 DB vs 서울 ↔ 미국 리전 간 복제

지연 시간을 알고 있어야:

* SLA(응답 시간 목표) 설계
* 캐싱 레이어 설계
* 멀티 리전/DR(재해 복구) 전략에서 “동기 복제 vs 비동기 복제” 트레이드오프 설명

이 가능해집니다.

---

## 3. 가용성(Availability)과 SLA

### “몇 9냐”를 실제 시간으로 보기

가용성(Availability)은 보통 다음처럼 표현합니다.

* 99% (two nines)
* 99.9% (three nines)
* 99.99% (four nines)
* 99.999% (five nines)

각각 대략적으로 허용되는 연간 다운타임은:

* 99%  → 1년에 약 3일 이상 장애 허용
* 99.9% → 1년에 약 9시간 정도
* 99.99% → 1년에 약 50분 정도
* 99.999% → 1년에 몇 분 수준

(정확 수치는 약간씩 다르지만, 이 정도 감각이면 충분합니다.)

### 웹 서비스 기준으로 해석하기

* 어드민/내부 도구

  * 99% 정도도 실무에서 크게 문제 안 될 수 있음
* 사용자-facing 핵심 서비스(로그인, 결제, 포인트, 주문 등)

  * 보통 99.9% 이상을 KPI로 잡는 경우 많음
* 금융/통신/대규모 B2B 인프라 등

  * 99.99% 혹은 그 이상 가용성을 요구하기도 함

### 설계에 어떻게 반영하나?

가용성 목표에 따라:

* 단일 서버 vs 다중 서버
* 단일 AZ vs 멀티 AZ
* 단일 리전 vs 멀티 리전
* 헬스 체크, 장애 감지 및 자동 복구(오토스케일링, 장애 조치) 수준

이 달라집니다.

예시 멘트:

* “이 결제/포인트 API는 99.9% 이상 가용성이 필요하다고 가정하겠습니다.
  그래서 단일 인스턴스가 아니라, 최소 2개 이상 인스턴스를 서로 다른 AZ에 배치하고, 로드밸런서를 통해 장애 시 트래픽을 다른 인스턴스로 우회시키겠습니다.”

---

## 4. QPS, 저장 용량 등 규모 추정 연습

### 4-1. QPS(Queries Per Second) 추정

기본 공식:

* `하루 호출 수 / 86400 ≈ 평균 QPS`
* 피크 트래픽은 보통 평균의 2~3배 이상으로 잡습니다.

예시:

* DAU(일간 활성 사용자) = 100,000
* 유저 1명이 하루에 댓글을 평균 2개 작성
* 하루 댓글 작성 수 = 200,000
* 평균 QPS ≈ `200,000 / 86,400 ≈ 2.3 QPS`
* 피크 QPS ≈ 5~7 QPS 정도로 가정

이걸 기반으로:

* 인스턴스 1대가 처리 가능한 QPS
* DB 쓰기 TPS
* 메시지 큐/캐시 처리량

을 거꾸로 계산하면서, “서버 몇 대, DB 스펙 어느 정도”를 추정합니다.

### 4-2. 저장 용량 추정

기본 흐름:

1. 이벤트 1건의 평균 크기(KB) 추정

   * 예: 댓글 1건 평균 500Byte ~ 1KB
2. 하루 발생량 = 이벤트 수 × 이벤트 크기
3. 연간 저장량 = 하루 발생량 × 365
4. 복제(마스터/슬레이브, 백업 등)를 고려하면 ×2, ×3 배수로 잡기

예시:

* 하루 댓글 200,000건
* 댓글 1건 1KB로 가정
* 하루 데이터 ≈ 200MB
* 1년 데이터 ≈ 73GB
* 복제/백업 고려 시 ×3 → 1년 ≈ 200GB대

### 4-3. 간단한 서비스 예시(트위터 스타일)

* MAU, DAU 가정
* 유저당 하루 트윗 수
* 트윗당 평균 크기
* 미디어 첨부 비율(이미지, 동영상은 별도 스토리지, CDN 고려)
* 보존 기간(데이터를 몇 년 보관할지)

이런 식으로 숫자를 정리하면:

* API 서버 수
* 캐시 메모리 규모
* DB/스토리지 용량
* 메시지 큐/스트림 처리량

을 대략 찍어볼 수 있습니다.

---

## 5. 2장을 실무/면접에 어떻게 쓰나

### 시스템 설계 면접에서의 활용

* “우리 서비스 유저 수가 이 정도, 하루 행동이 이 정도라서 QPS는 대략 ~ 이고, 그에 맞춰 서버/DB/캐시를 이렇게 잡겠습니다.”
  → 그냥 “서버 3대쯤…”이 아니라, 숫자로부터 논리적으로 도출하는 모습 보여주기.
* “이 수준의 QPS라면 단일 DB 인스턴스로도 버티지만, 가용성 99.9%를 위해 리플리카/슬레이브를 붙이겠습니다.”
  → 가용성 목표와 구조를 함께 얘기.

### 설계 문서/README에 활용

* 프로젝트 README나 설계 문서에 다음 섹션으로 녹일 수 있습니다.

  * 가정(Assumptions)

    * DAU, QPS, 데이터 크기, 보존 기간
  * 목표(Goals)

    * 응답 시간, 가용성(예: 99.9%)
  * 리스크(Risks)

    * 피크 시간 트래픽 폭주, 특정 유저/회사에 트래픽 몰림 등

이렇게 숫자와 함께 정리해두면, 같은 기능이라도 “대규모 트래픽까지 고려한 설계”라는 인상을 줄 수 있습니다.

---

## 6. 정리: 2장의 핵심 메시지

* “기능만” 설계하는 게 아니라, **규모·성능·가용성**을 숫자로 이야기할 수 있어야 한다.
* 특히 다음 네 가지 감각을 가져가는 게 목표입니다.

  1. 데이터 크기(2의 제곱수 단위, KB/MB/GB/…) 감각
  2. 메모리/디스크/네트워크 지연 시간의 상대적인 차이
  3. 가용성 숫자(99.9%, 99.99%)를 실제 다운타임 시간으로 보는 눈
  4. DAU, 액션 수를 기반으로 QPS·저장 용량을 대략 추정하는 능력

